<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="https://davel17.github.io/fogbert.css">
    <meta charset="UTF-8">
    <title>Thingspeak Plugin for Indigo Home Control Server</title>

    <!-- The following script auto-sizes the height of the iframe to the height of the content being displayed -->
    <script type="text/javascript">
        function resize_iframe(obj) {
            obj.style.height = 0;
            obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
        }
    </script>
</head>

<header>
    <img style="margin: 0px auto; display: block" src="img/img_thingspeakLogo.png">
</header>
<body>

<nav>
    <a href="https://github.com/DaveL17/thingspeak/releases/"><img src="https://davel17.github.io/img/img_download.png"></a>
    <a href="http://forums.indigodomo.com/viewforum.php?f=151"><img src="https://davel17.github.io/img/img_forum.png"></a>
    <a href="https://github.com/DaveL17/thingspeak/wiki"><img src="https://davel17.github.io/img/img_wiki.png"></a>
</nav>

<h1>About</h1>
<p>
    The Thingspeak plugin allows users to create Indigo Home Control Server devices which provide a facility to upload Indigo data to Thingspeak for charting and other purposes. Each
    individual device can contain up to eight data elements for upload. There is no limit to the number of Thingspeak Channels that the plugin can support.

</p>
<p>
    <span class="warningText">Notes: </span>for prior versions, please use <a href="version_1.0.html">these instructions</a>.  The Thingspeak plugin requires access to the Internet in
    order to work with the Thingspeak service.
</p>

<h3>Installation</h3>
<figure class="TextWrap">
    <figcaption>Thingspeak Plugin Configuration Dialog</figcaption>
    <img class="TextWrap" src="img/img_pluginConfigDialog_v1.1.png">
</figure>
<p>
    Installing the Thingspeak Plugin is accomplished in the same way that you would install other Indigo plugins. There are no additional steps or other Python packages that need to be
    installed. From the computer where the Indigo Server resides (you can’t directly install plugins from a client machine), download the current plugin file from the link above and then
    double-click on the archive file. Indigo will prompt you to install the plugin. Once the plugin has been successfully installed, you will need to configure the plugin to work with
    your desired implementation. During installation, Indigo should present you with the Plugin Configuration dialog. If for some reason that doesn’t happen, or if you want to make
    additional changes later, you can always get to the Plugin Configuration dialog by going to the Indigo main menu and selecting Plugins —> Thingspeak —> Configure...
</p>
<p>
    All settings that affect the plugin’s overall operations are found in the Plugin Configuration dialog. The settings are divided into four sections: Upload Settings, Optional
    Settings, Plugin Update Notification Settings, and Debug Settings.
</p>
<ul>
    <li>
        <span>Upload Settings</span>
        <p>
            Thingspeak Upload Settings apply to all operations of the plugin. There are three settings: API Key, Log File Path, and Local Server.
        </p>
        <ul>
            <li>
                <span>API Key</span>
                <p>
                    The API Key is your main Thingspeak API key found in your account settings on the Thingspeak website. This key is required in order for the plugin to communicate with
                    Thingspeak and is used in constructing Thingspeak API calls (like uploading data and configuring Thingspeak Channels). This key is only retained locally and is not
                    captured or transmitted anywhere but Thingspeak.
                </p>
            </li>
            <li>
                <span>Log File Path</span>
                <p>
                    The log file path is used to designate where you would like the plugin's log file to be saved. The default location is:
                    '/Library/Application Support/Perceptive Automation/Indigo 7/Logs/Thingspeak Log.txt'; however, you can set this path to any location that the Indigo Server can
                    access.
                </p>
            </li>
            <li>
                <span>Local Server</span>
                <p>
                    The Local Server setting allows for installations where a Thingspeak Server is running on the local LAN. If you don't have a local server running, or don't know what
                    any of this means, leave this setting unchecked.
                </p>
            </li>
        </ul>
    </li>
    <li>
        <span>Optional Settings</span>
        <p>
            The plugin maintains a number of optional settings regarding aspects of your Thingspeak Plugin framework. These settings are entirely optional and can be left at their
            default settings. You can also choose to populate some and not others (although it would be weird to set latitude and not longitude I suppose.) They are provided because it
            is possible to upload this information to your Thingspeak channels should you choose to do so. The settings here will pertain to all of your Thingspeak devices.
        </p>
        <ul>
            <li>
                <span>Latitude and Longitude</span>
                <p>
                    Latitude and Longitude are decimal values, and the sign of each number is important. A wrong sign here could accidentally put you on the other side of the world.
                </p>
            </li>
            <li>
                <span>Elevation</span>
                <p>
                    The elevation value is a whole number integer and is measured in meters (and can also be negative.)
                </p>
            </li>
            <li>
                <span>Twitter ID</span>
                <p>
                    Thingspeak supports integration with Twitter through its Thingspeak Apps. In order to use the Twitter functionality, you must first log in to your Thingspeak account
                    and enable the ThingTweet app. Once enabled, enter the registered Twitter username in the Twitter textfield. In order to be useful, you must also complete a
                    device-specific setting (discussed below).
                </p>
            </li>
        </ul>
    </li>
    <li>
        <span>Plugin Update Notifications (optional)</span>
        <p>
            The plugin update notification settings tell the plugin to alert you when a new version of the plugin is available. To enable notifications, check the appropriate box and
            enter a valid email address. This facility also requires that the user enable Indigo’s facility to send and receive email messages. The plugin does not send messages on its
            own or collect any information about usage. All personal information is stored on the user’s machine.
        </p>
    </li>
    <li>
        <span>Debugging</span>
        <p>
            If things aren’t working the way that you expect them to, turning on the debugging facility within the plugin can help us isolate the cause, and the output is tremendously
            useful when reporting bugs. There are three levels of debug logging—Low, Medium and High. Selecting Low, provides a minimal amount of debug logging (might still be a lot,
            really.) Medium provides for a pretty massive amount of logging (but keeps all sensitive data like API Write Keys from being displayed.) A setting of High will allow this
            sensitive information to be logged, so use with care when posting log results to a public place.
        </p>
    </li>
</ul>
<p>
    That’s the extent of the settings that affect the overall operation of the plugin. But we’re still not done setting up our Thingspeak Plugin implementation. Now we must create
    devices that will manage the data that we want to upload.
</p>

<h3>Devices</h3>
<figure class="TextWrap">
    <figcaption>Thingspeak Device Configuration Dialog</figcaption>
    <img class="TextWrap" src="img/img_deviceConfigDialogv1.1.png">
</figure>

<p>
    Thingspeak Plugin Devices are where most of the magic happens. Begin by creating a new Thingspeak device within Indigo. There is only one device model available—Thingspeak Data
    Upload Device:
</p>
<ul>
    <li>
        <span>Channel</span>
        <p>
            Select the channel that you would like to link to this device from the dropdown menu. Note that each time you open a device settings dialog, the plugin will reach out to the
            Thingspeak server to obtain the current list of available channels.  As a result, it may take a few moments for the dialog to open.
        </p>
    </li>
    <li>
        <span>Upload Interval</span>
        <p>
            Each Thingspeak plugin device has its own upload interval. Select from the list of available options using the Upload Interval dropdown menu. Note that Thingspeak will not
            accept upload intervals shorter than 15 seconds for free plans. If there is a call for upload frequencies shorter than 15 seconds, please contact me (this may be especially
            useful for installations that run a local Thingspeak server).
        </p>
    </li>
    <li>
        <span>Tweet</span>
        <p>
            If you have a valid Twitter username linked to the ThingTweet App (see Thingspeak Apps for more information), the plugin will send the Tweet text along with the rest of the
            payload. If you do not have a valid Twitter username linked to ThingTweet, the text entered here will be ignored.
        </p>
    </li>
    <li>
        <span>Things</span>
        <p>
            Each Thingspeak Device can contain up to 8 data elements for upload (a limitation imposed by Thingspeak, not by the plugin); however, you can create as many Thingspeak Data
            Upload devices as you wish. Data elements are added in the following few steps: 1) Select the source for your data from a list of all Indigo devices and variables, and 2)
            select the corresponding value. Select as many or as few as you wish. It isn't necessary to start with the first element. For example, you may only want to update Thing 4 on
            that particular Thingspeak channel.
        </p>
    </li>
</ul>
<p>
    When you’re done adding Things, give your new Thingspeak device a name and then exit the Edit Device dialog box.
</p>
<p>
    After the plugin has had a chance to cycle and upload your data, several custom device states will be populated with select information. The data that appears in the custom device
    states is based on the communication with the Thingspeak servers and represents the data that Thingspeak received from you. In other words, this is the information as in appears on
    the Thingspeak servers. The data include the channel ID, the timestamp of the record, and the entry ID.
</p>
<p>
    During the course of operation, the plugin will provide useful information via the Indigo User Interface.
</p>
<ul>
    <li>
        <span>Icons</span>
        <p>
            The corresponding icon for each device will change depending on that device's status.
        </p>
        <ul>
            <li>
                <span class="onlineText">Green</span>
                <p>
                    All is well. Each time the plugin cycles, the Indigo State column will display, "enabled", "processing", and if all has gone according to plan, "OK".
                </p>
            </li>
            <li>
                <span class="offlineText">Gray</span>
                <p>
                    The device is offline. For example, if you disable communication for the device in the Indigo UI, the icon will display gray, and the Indigo State will change to
                    "disabled".
                </p>
            </li>
            <li>
                <span class="warningText">Red</span>
                <p>
                    An error has occurred. For example, if the Thingspeak servers are unreachable, the icon will display red and "no comm" will appear in the Indigo State column.
                </p>
            </li>
        </ul>
    </li>
</ul>

<h3>Actions</h3>
<p>
    There is currently one Indigo Action Item:
</p>
<ul>
    <li>
        <span>Upload Data Now</span>
        <p>
            used to request an upload of data on demand. This option can be used as a part of an Indigo Trigger like: “If X happens, upload my data to Thingspeak.”
        </p>
    </li>
</ul>

<h3>Menu Items</h3>
<figure class="TextWrap">
    <figcaption>Thingspeak Plugin Menu Items</figcaption>
    <img class="TextWrap" src="img/img_pluginMenuItemsv1.1.png">
</figure>

<p>
    There are a few custom menu items for the Thingspeak plugin:
</p>
<ul>
    <li>
        <span>Check for Plugin Updates</span>
        <p>
            Selecting this option will test whether there is an available update to the Thingspeak plugin. This option doesn’t require you to have an email account configured in Indigo
            (it will notify you in the Indigo log instead.)
        </p>
    </li>
    <li>
        <span>Enable/Disable All Devices</span>
        <p>
            These two menus items can be used to quickly enable (or disable) all Thingspeak plugin devices.
        </p>
    </li>
    <li>
        <span>Toggle Debugging</span>
        <p>
            This will toggle the debug option at whatever level is currently set in the plugin configuration dialog. If debug is on, selecting this option will turn it off (and vice
            versa.)
        </p>
    </li>
    <li>
        <span>Clear Channel Data...</span>
        <p>
            This tool allows you to clear all data from a Thingspeak channel. When you select this menu item, a dialog box will appear that allows you to select the channel to clear.
            The data will not be cleared until you select a channel and click on the "Clear" button.
            <br><br><span style = "color:red;background-color:black;">DANGER:</span> Changes made using this tool are permanent and cannot be undone.
        </p>
    </li>
    <li>
        <span>Create a channel...</span>
        <p>
            This tool allows you to create a new channel on the Thingspeak server. When you select this menu item, a dialog box will appear that allows you to configure the channel. All
            items in this dialog are optional--if you do not enter an element, Thingspeak will populate the element for you. Regardless of the information used to create the channel, you
            can always change it later. (Note that if you are running a local Thingspeak server, you will need to configure the device to work with your server so that's technically not
            optional.)
        </p>
    </li>
    <li>
        <span>Delete a Channel...</span>
        <p>
            This tool allows you to delete a channel from the Thingspeak server. When you select this menu item, a dialog box will appear that allows you to select the channel to
            delete. The channel will not be deleted until you select a channel and click on the "Delete" button.
            <br><br><span style = "color:red;background-color:black;">DANGER:</span> Changes made using this tool are permanent and cannot be undone.
        </p>
    </li>
    <li>
        <span>List Channels</span>
        <p>
            This tool allows you to print a list of available Thingspeak channels to the Indigo Event Log. This action happens immediately. No changes are made to your channels or your
            data by using this tool.
        </p>
    </li>
    <li>
        <span>Update Channel Info...</span>
        <p>
            This tool allows you to change channel settings for existing Thingspeak channels. The plugin reaches out to the Thingspeak server to get a list of available channels, so it
            may take a moment to open. Select the channel to change using the dropdown menu. Once you select a channel, the plugin will reach out to the Thingspeak servers again to get
            the current information for the channel you selected and will populate the fields with that data. Make any needed changes to the data fields and then select the "Update"
            button. Once you select the Update button, the changes will be committed -- but if you make a mistake or change your mind, you can reuse the tool to fix any problems. You
            can hover your mouse cursor over each field to get helpful hints on ways to configure the information.
        </p>
    </li>
    <li>
        <span>Upload Data Now</span>
        <p>
            This will cause the plugin to initiate a refresh cycle outside the scheduled update. This will not be successful if the last update was less than 15 seconds ago. This is a
            (completely reasonable) time limit imposed by Thingspeak—not imposed by the plugin (that is, unless you are running your own server or have a paid plan with Thingspeak. In
            these cases, there is no limit to the number of uploads).
        </p>
    </li>
</ul>

<h3>Framework</h3>
<p>
    The framework of the entire environment as it relates to Indigo is very straightforward. Indigo talks through the plugin to the Thingspeak servers to allow users to upload data from
    their Indigo installations to the Thingspeak data network. Communication is bi-directional and presently happens through routine calls using common Python communication protocols.
    Plugin users choose a predefined upload interval through a standard plugin configuration setting, the plugin reaches out to the Thingspeak servers and uploads/downloads data, and
    Thingspeak responds with a message denoting success (or lack thereof.) This plugin is designed to work with Indigo 6.0 and above and is therefore compatible with Python 2.6. I will
    do my best to account for other implementations where possible, but sometimes I will not be able to do that when it would cause a loss of functionality or break existing frameworks.
    I will also work to continue to keep the plugin current as Indigo, its Python implementation and the Thingspeak API evolve over time.
</p>

<h3>Scripting and Technical Details</h3>
<p>
    <i class="underConstruction">
        Under construction.
    </i>
</p>
<ul>
    <li><code>com.fogbert.indigoplugin.thingspeak</code></li>
</ul>

<iframe src="../features_and_bugs.html" frameborder="0" scrolling="no" width="100%" onload="resize_iframe(this);"></iframe>
<iframe src="../license.html" frameborder="0" scrolling="no" width="100%" onload="resize_iframe(this);"></iframe>

</body>
</html>
