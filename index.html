<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="https://davel17.github.io/fogbert.css">
    <meta charset="UTF-8">
    <title>Thingspeak Plugin for Indigo Home Control Server</title>

    <!-- The following script auto-sizes the height of the iframe to the height of the content being displayed -->
    <script type="text/javascript">
        function resize_iframe(obj) {
            obj.style.height = 0;
            obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
        }
    </script>
</head>

<header>
    <img style="margin: 0px auto; display: block" src="img/img_thingspeakLogo.png">
</header>
<body>

<nav>
    <a href="https://github.com/DaveL17/thingspeak/releases/"><img src="https://davel17.github.io/img/img_download.png"></a>
    <a href="http://forums.indigodomo.com/viewforum.php?f=151"><img src="https://davel17.github.io/img/img_forum.png"></a>
    <a href="https://github.com/DaveL17/thingspeak/wiki"><img src="https://davel17.github.io/img/img_wiki.png"></a>
</nav>

<h1>About</h1>
<p>
    The Thingspeak plugin allows users to create Indigo Home Control Server devices which provide a facility to upload Indigo data to Thingspeak for charting and other purposes. Each
    individual device can contain up to eight data elements for upload. There is no limit to the number of Thingspeak Channels that the plugin can support.
</p>

<h3>Installation</h3>
<figure class="TextWrap">
    <figcaption>Thingspeak Plugin Configuration Dialog</figcaption>
    <img class="TextWrap" src="img/img_pluginConfigDialog.png">
</figure>
<p>
    Installing the Thingspeak Plugin is accomplished in the same way that you would install other Indigo plugins. There are no additional steps or other Python packages that need to be
    installed. From the computer where the Indigo Server resides (you can’t directly install plugins from a client machine), download the current plugin file from the link above and then
    double-click on the archive file. Indigo will prompt you to install the plugin. Once the plugin has been successfully installed, you will need to configure the plugin to work with
    your desired implementation. During installation, Indigo should present you with the Plugin Configuration dialog. If for some reason that doesn’t happen, or if you want to make
    additional changes later, you can always get to the Plugin Configuration dialog by going to the Indigo main menu and selecting Plugins —> Thingspeak —> Configure...
</p>
<p>
    All settings that affect the plugin’s overall operations are found in the Plugin Configuration dialog. The settings are divided into four sections: Upload Settings, Optional
    Settings, Plugin Update Notification Settings, and Debug Settings.
</p>
<ul>
    <li>
        <span>Upload Settings</span>
        <p>
            Thingspeak Upload Settings control the frequency with which the plugin interacts with the Thingspeak system. There is only one plugin timing setting: Upload Interval. The
            Upload interval setting controls how often each Thingspeak Plugin device will reach out to the Thingspeak servers to upload data. This setting affects all devices that you
            create (all devices upload at the same frequency.) The options range from every 15 seconds to once per day (15 seconds is the minimum allowed by Thingspeak.)
        </p>
    </li>
    <li>
        <span>Optional Settings</span>
        <p>
            The plugin maintains a number of optional settings regarding aspects of your Thingspeak Plugin framework. These settings are entirely optional and can be left at their
            default settings. You can also choose to populate some and not others (although it would be weird to set latitude and not longitude I suppose.) They are provided because it
            is possible to upload this information to your Thingspeak channels should you choose to do so. The settings here will pertain to all of your Thingspeak devices.
        </p>
        <ul>
            <li>
                <span>Latitude and Longitude</span>
                <p>
                    Latitude and Longitude are decimal values, and the sign of each number is important. A wrong sign here could accidentally put you on the other side of the world.
                </p>
            </li>
            <li>
                <span>Elevation</span>
                <p>
                    The elevation value is a whole number integer and is measured in meters (and can also be negative.)
                </p>
            </li>
            <li>
                <span>Twitter ID</span>
                <p>
                    Thingspeak supports integration with Twitter through its Thingspeak Apps. In order to use the Twitter functionality, you must first log in to your Thingspeak account
                    and enable the ThingTweet app. Once enabled, enter the registered Twitter username in the Twitter textfield. In order to be useful, you must also complete a
                    device-specific setting (discussed below).
                </p>
            </li>
        </ul>
    </li>
    <li>
        <span>Update Notifications (optional)</span>
        <p>
            The plugin update notification settings tell the plugin to alert you when a new version of the plugin is available. To enable notifications, check the appropriate box and
            enter a valid email address. This facility also requires that the user enable Indigo’s facility to send and receive email messages. The plugin does not send messages on its
            own or collect any information about usage. All personal information is stored on the user’s machine.
        </p>
    </li>
    <li>
        <span>Log File Path</span>
        <p>
            Enter the full path (including the filename) where you would like to save the Thingspeak plugin logfile. If the specified location doesn't exist, the plugin will attempt to
            create if for you.
        </p>
    </li>
    <li>
        <span>Debugging</span>
        <p>
            If things aren’t working the way that you expect them to, turning on the debugging facility within the plugin can help us isolate the cause, and the output is tremendously
            useful when reporting bugs. There are three levels of debug logging—Low, Medium and High. Selecting Low, provides a minimal amount of debug logging (might still be a lot,
            really.) Medium provides for a pretty massive amount of logging (but keeps all sensitive data like API Write Keys from being displayed.) A setting of High will allow this
            sensitive information to be logged, so use with care when posting log results to a public place.
        </p>
    </li>
</ul>
<p>
    That’s the extent of the settings that affect the overall operation of the plugin. But we’re still not done setting up our Thingspeak Plugin implementation. Now we must create
    devices that will manage the data that we want to upload.
</p>

<h3>Devices</h3>
<figure class="TextWrap">
    <figcaption>Thingspeak Device Configuration Dialog</figcaption>
    <img class="TextWrap" src="img/img_deviceConfigDialog.png">
</figure>

<p>
    Thingspeak Plugin Devices are where most of the magic happens. Begin by creating a new Thingspeak device within Indigo. There is only one device model available—Thingspeak Data
    Upload Device:
</p>
<ul>
    <li>
        <span>API Write Key</span>
        <p>
            This key is obtained from Thingspeak. Each Thingspeak channel has a unique write key, and each Thingspeak Plugin device should have a unique write key as well.
        </p>
    </li>
    <li>
        <span>Local Server</span>
        <p>
            If this box is checked, a field will appear for you to enter the local IP address of your personal Thingspeak server. If you later uncheck the box, the plugin will attempt to
            perform the upload to Thingspeak's servers.
        </p>
    </li>
    <li>
        <span>Tweet</span>
        <p>
            If you have a valid Twitter username linked to the ThingTweet App (see Thingspeak Apps for more information), the plugin will send the Tweet text along with the rest of the
            payload. If you do not have a valid Twitter username linked to ThingTweet, the text entered here will be ignored.
        </p>
    </li>
    <li>
        <span>Things</span>
        <p>
            Each Thingspeak Device can contain up to 8 data elements for upload (a limitation imposed by Thingspeak, not by the plugin); however, you can create as many Thingspeak Data
            Upload devices as you wish. Data elements are added in the following few steps: 1) Select the source for your data from a list of all Indigo devices and variables, and 2)
            select the corresponding value. Select as many or as few as you wish. It isn't necessary to start with the first element. For example, you may only want to update Thing 4 on
            that particular Thingspeak channel.
        </p>
    </li>
</ul>
<p>
    When you’re done adding Things, give your new Thingspeak device a name and then exit the Edit Device dialog box.
</p>
<p>
    After the plugin has had a chance to cycle and upload your data, several custom device states will be populated with select information. The data that appears in the custom device
    states is based on the communication with the Thingspeak servers and represents the data that Thingspeak received from you. In other words, this is the information as in appears on
    the Thingspeak servers. The data include the channel ID, the timestamp of the record, and the entry ID.
</p>
<p>
    During the course of operation, the plugin will provide useful information via the Indigo User Interface.
</p>
<ul>
    <li>
        <span>Icons</span>
        <p>
            The corresponding icon for each device will change depending on that device's status.
        </p>
        <ul>
            <li>
                <span class="onlineText">Green</span>
                <p>
                    All is well. Each time the plugin cycles, the Indigo State column will display, "enabled", "processing", and if all has gone according to plan, "OK".
                </p>
            </li>
            <li>
                <span class="offlineText">Gray</span>
                <p>
                    The device is offline. For example, if you disable communication for the device in the Indigo UI, the icon will display gray, and the Indigo State will change to
                    "disabled".
                </p>
            </li>
            <li>
                <span class="warningText">Red</span>
                <p>
                    An error has occurred. For example, if the Thingspeak servers are unreachable, the icon will display red and "no comm" will appear in the Indigo State column.
                </p>
            </li>
        </ul>
    </li>
</ul>

<h3>Actions</h3>
<p>
    There is currently one Indigo Action Item:
</p>
<ul>
    <li>
        <span>Upload Data Now</span>
        <p>
            used to request an upload of data on demand. This option can be used as a part of an Indigo Trigger like: “If X happens, upload my data to Thingspeak.”
        </p>
    </li>
</ul>

<h3>Menu Items</h3>
<figure class="TextWrap">
    <figcaption>Thingspeak Plugin Menu Items</figcaption>
    <img class="TextWrap" src="img/img_pluginMenuItems.png">
</figure>

<p>
    There are a few custom menu items for the Thingspeak plugin:
</p>
<ul>
    <li>
        <span>Enable/Disable All Devices</span>
        <p>
            These two menus items can be used to quickly enable (or disable) all Thingspeak plugin devices.
        </p>
    </li>
    <li>
        <span>Check for Plugin Updates</span>
        <p>
            Selecting this option will test whether there is an available update to the Thingspeak plugin. This option doesn’t require you to have an email account configured in Indigo
            (it will notify you in the Indigo log instead.)
        </p>
    </li>
    <li>
        <span>Upload Data Now</span>
        <p>
            This will cause the plugin to initiate a refresh cycle outside the scheduled update. This will not be successful if the last update was less than 15 seconds ago. This is a
            (completely reasonable) time limit imposed by Thingspeak—not imposed by the plugin.
        </p>
    </li>
    <li>
        <span>Toggle Debugging</span>
        <p>
            This will toggle the debug option at whatever level is currently set in the plugin configuration dialog. If debug is on, selecting this option will turn it off (and vice
            versa.)
        </p>
    </li>
</ul>

<h3>Framework</h3>
<p>
    The framework of the entire environment as it relates to Indigo is very straightforward. Indigo talks through the plugin to the Thingspeak servers to allow users to upload data from
    their Indigo installations to the Thingspeak data network. Communication is bi-directional (but only slightly), and presently happens through routine calls using common Python
    communication protocols. Plugin users choose a predefined upload interval through a standard plugin configuration setting, the plugin reaches out to the Thingspeak servers and
    uploads data, and Thingspeak responds with a message denoting success (or lack thereof.) This plugin is designed to work with Indigo 6.0 and above and is therefore compatible with
    Python 2.6. I will do my best to account for other implementations where possible, but sometimes I will not be able to do that when it would cause a loss of functionality or break
    existing frameworks. I will also work to continue to keep the plugin current as Indigo, its Python implementation and Thingspeak API evolve over time.
</p>

<h3>Scripting and Technical Details</h3>
<p>
    <i class="underConstruction">
        Under construction.
    </i>
</p>
<ul>
    <li><code>com.fogbert.indigoplugin.thingspeak</code></li>
</ul>

<iframe src="../features_and_bugs.html" frameborder="0" scrolling="no" width="100%" onload="resize_iframe(this);"></iframe>
<iframe src="../license.html" frameborder="0" scrolling="no" width="100%" onload="resize_iframe(this);"></iframe>

</body>
</html>
